{% extends 'base.html' %}
{% block content %}

{% if request.user.is_staff %}

<style>
    /* Deixa as setas mais para cima */
#categoriesCarousel .carousel-control-prev,
#categoriesCarousel .carousel-control-next {
    top: 40%;   /* muda a altura (default é 50%) */
    transform: translateY(-20%);
}

/* Se quiser aproximar mais do conteúdo */
#categoriesCarousel .carousel-control-prev {
    left: -85px; /* mais para fora da esquerda */
}

#categoriesCarousel .carousel-control-next {
    right: -85px; /* mais para fora da direita */
}

</style>
<div class="mb-3 text-end">
    <a href="/admin/knowledge/process/add/" class="btn btn-success">
        + Adicionar Processo
    </a>
</div>
{% endif %}

<div class="row g-3 align-items-end">
    <div class="col-md-6 position-relative">
        <form method="get" action="{% url 'knowledge:home' %}">
            <label class="form-label">Buscar processos</label>
            <input id="q" name="q" value="{{ q }}" class="form-control form-control-lg"
                placeholder="Ex.: Comissões, Reembolsos, Conciliação...">
            <ul id="suggest" class="search-suggest list-unstyled mt-1 d-none"></ul>
        </form>
    </div>
    <div class="col-md-4">
        <label class="form-label">Filtrar por categoria</label>
        <form method="get">
            {% if q %}
            <input type="hidden" name="q" value="{{ q }}">
            {% endif %}
            <select name="cat" class="form-select" onchange="this.form.submit()">
                <option value="">Todas</option>
                {% for c in categories %}
                <option value="{{ c.slug }}" {% if cat == c.slug %}selected{% endif %}>{{ c.name }}</option>
                {% endfor %}
            </select>
        </form>
    </div>
</div>

<hr>

<!-- CATEGORIAS EM CARROSSEL -->
<section class="categories-section mb-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h4 class="fw-bold text-dark mb-0">Categorias de Processos</h4>
        <a href="#" class="btn btn-sm btn-outline-primary">Ver todas <i class="bi bi-arrow-right ms-1"></i></a>
    </div>

    <div id="categoriesCarousel" class="carousel slide position-relative" data-bs-ride="carousel">
        <div class="carousel-inner">

            {% for c in categories %}
            {% if forloop.counter0|divisibleby:3 %}
            <div class="carousel-item {% if forloop.first %}active{% endif %}">
                <div class="row g-3">
            {% endif %}

            <div class="col-md-4">
                <a href="{% url 'knowledge:by_category' c.slug %}" class="text-decoration-none">
                    <div class="card h-100 border-0 shadow-sm">
                        <div class="card-body p-3 d-flex align-items-center justify-content-between">
                            <div class="d-flex align-items-center">
                                <div class="icon-container bg-primary bg-opacity-10 rounded-3 p-3 me-3">
                                    <i class="bi bi-diagram-3-fill fs-3 text-primary"></i>
                                </div>
                                <div>
                                    <h6 class="mb-1 text-dark fw-semibold">{{ c.name }}</h6>
                                    <small class="text-muted">{{ c.description|default:"Sem descrição"|truncatewords:8 }}</small>
                                </div>
                            </div>
                            <span class="badge bg-primary">{{ c.processes.count }}</span>
                        </div>
                    </div>
                </a>
            </div>

            {% if forloop.counter|divisibleby:3 or forloop.last %}
                </div>
            </div>
            {% endif %}
            {% endfor %}

        </div>

        <!-- Controles (setas laterais centralizadas) -->
        <button class="carousel-control-prev" type="button" data-bs-target="#categoriesCarousel" data-bs-slide="prev">
            <span class="carousel-control-prev-icon bg-dark rounded-circle p-1" aria-hidden="true"></span>
            <span class="visually-hidden">Anterior</span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#categoriesCarousel" data-bs-slide="next">
            <span class="carousel-control-next-icon bg-secondary rounded-circle p-1" aria-hidden="true"></span>
            <span class="visually-hidden">Próximo</span>
        </button>
    </div>
</section>


<div id="results" class="row g-3">
    {% include 'knowledge/partials/_process_cards.html' with processes=processes %}
</div>

{% endblock %}